# 微信小程序页面开发指南

## 一、WXML 页面结构

WXML（WeiXin Markup Language）是微信小程序的标记语言，用于描述页面的结构。

### 1. 基本标签

```html
<!-- 容器组件 -->
<view class="container">
  <text class="title">Hello World</text>
</view>

<!-- 图片组件 -->
<image src="/images/logo.png" mode="aspectFit"></image>

<!-- 按钮组件 -->
<button bindtap="handleTap">点击我</button>
```

### 2. 数据绑定

WXML使用双大括号语法进行数据绑定：

```javascript
// index.js
Page({
  data: {
    message: 'Hello World',
    count: 10,
    user: {
      name: '张三',
      age: 25
    },
    isShow: true,
    items: ['苹果', '香蕉', '橙子']
  }
});
```

```html
<!-- 绑定文本 -->
<text>{{message}}</text>

<!-- 绑定属性 -->
<view class="{{isActive ? 'active' : ''}}"></view>

<!-- 条件渲染 -->
<view wx:if="{{isShow}}">显示内容</view>
<view wx:else>隐藏内容</view>

<!-- 列表渲染 -->
<view wx:for="{{items}}" wx:key="index">
  {{index}}: {{item}}
</view>
```

### 3. 事件绑定

```html
<!-- 绑定点击事件 -->
<button bindtap="handleTap">点击</button>

<!-- 绑定长按事件 -->
<view bindlongpress="handleLongPress">长按我</view>

<!-- 阻止事件冒泡 -->
<view catchtap="handleTap">点击不冒泡</view>

<!-- 传递参数 -->
<button data-id="123" bindtap="handleTap">带参数的按钮</button>
```

```javascript
// index.js
Page({
  handleTap(event) {
    // event.currentTarget.dataset.id 可以获取参数
    console.log('按钮被点击', event);
  },
  
  handleLongPress() {
    console.log('长按事件');
  }
});
```

## 二、WXSS 样式

WXSS（WeiXin Style Sheets）是微信小程序的样式语言。

### 1. 基本选择器

```css
/* 标签选择器 */
view {
  color: #333;
}

/* 类选择器 */
.container {
  padding: 20rpx;
}

/* ID选择器 */
#myId {
  font-size: 32rpx;
}

/* 子选择器 */
.parent .child {
  margin: 10rpx;
}

/* 伪类选择器 */
button:active {
  opacity: 0.8;
}
```

### 2. rpx 单位

rpx（responsive pixel）是微信小程序特有的响应式单位：

```css
/* 设计稿750px宽的情况下：
   1rpx = 0.5px = 1物理像素
   在其他屏幕上会自动换算
*/
.container {
  width: 750rpx;  /* 满屏宽度 */
  height: 200rpx;
  padding: 20rpx;
  margin: 10rpx;
}
```

### 3. 常用样式属性

```css
/* 布局 */
.container {
  display: flex;           /* 弹性盒模型 */
  flex-direction: column;  /* 垂直排列 */
  align-items: center;     /* 水平居中 */
  justify-content: center;  /* 垂直居中 */
}

/* 文字 */
.text {
  font-size: 32rpx;         /* 字体大小 */
  font-weight: bold;       /* 粗体 */
  color: #333;              /* 颜色 */
  text-align: center;      /* 对齐方式 */
}

/* 盒子模型 */
.box {
  width: 200rpx;
  height: 200rpx;
  padding: 20rpx;
  margin: 10rpx;
  border: 1px solid #ccc;
  background-color: #fff;
  border-radius: 10rpx;
}

/* 背景 */
.background {
  background-color: #f5f5f5;
  background-image: url('/images/bg.png');
  background-size: cover;
}
```

### 4. 样式导入

```css
/* 使用@import导入外部样式 */
@import '/common/common.wxss';

.local-class {
  color: red;
}
```

## 三、JavaScript 逻辑

### 1. Page 生命周期

```javascript
Page({
  // data: 页面初始数据
  data: {
    message: 'Hello'
  },

  // onLoad: 页面加载时触发（只执行一次）
  onLoad: function(options) {
    console.log('页面加载', options);
  },

  // onShow: 页面显示时触发
  onShow: function() {
    console.log('页面显示');
  },

  // onReady: 页面初次渲染完成
  onReady: function() {
    console.log('页面渲染完成');
  },

  // onHide: 页面隐藏时触发
  onHide: function() {
    console.log('页面隐藏');
  },

  // onUnload: 页面卸载时触发
  onUnload: function() {
    console.log('页面卸载');
  }
});
```

### 2. 更新数据

```javascript
Page({
  data: {
    count: 0
  },

  addCount: function() {
    // 使用 this.setData() 更新数据
    this.setData({
      count: this.data.count + 1
    });
  },

  asyncAdd: function() {
    // setData 支持回调函数
    this.setData({
      count: this.data.count + 1
    }, () => {
      console.log('数据更新完成');
    });
  }
});
```

### 3. 常用API调用

```javascript
Page({
  onLoad: function() {
    // 显示提示框
    wx.showToast({
      title: '成功',
      icon: 'success',
      duration: 2000
    });

    // 发起网络请求
    wx.request({
      url: 'https://api.example.com/data',
      method: 'GET',
      success: (res) => {
        console.log('请求成功', res);
      },
      fail: (err) => {
        console.log('请求失败', err);
      }
    });

    // 获取用户信息
    wx.getUserProfile({
      desc: '用于展示用户信息',
      success: (res) => {
        console.log('用户信息', res.userInfo);
      }
    });
  }
});
```

## 四、常见问题

### 1. 数据不更新？

确保使用 `this.setData()` 方法更新数据，而不是直接修改 `this.data`。

```javascript
// 错误写法
this.data.count = 1;

// 正确写法
this.setData({
  count: 1
});
```

### 2. 事件参数获取？

使用 `event.currentTarget.dataset` 获取通过 `data-*` 传递的参数。

```html
<button data-id="123" data-name="按钮" bindtap="handleTap">点击</button>
```

```javascript
Page({
  handleTap: function(event) {
    const id = event.currentTarget.dataset.id;
    const name = event.currentTarget.dataset.name;
    console.log(id, name); // 123, 按钮
  }
});
```

### 3. 页面间跳转？

```javascript
// 跳转到新页面（可返回）
wx.navigateTo({
  url: '/pages/detail/detail?id=123'
});

// 跳转并关闭当前页面（不可返回）
wx.redirectTo({
  url: '/pages/detail/detail'
});

// 跳转到tabBar页面
wx.switchTab({
  url: '/pages/index/index'
});
```
